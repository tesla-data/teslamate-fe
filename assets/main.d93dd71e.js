var de=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Z=(l,t,e)=>t in l?de(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,ee=(l,t)=>{for(var e in t||(t={}))pe.call(t,e)&&Z(l,e,t[e]);if(Q)for(var e of Q(t))Ve.call(t,e)&&Z(l,e,t[e]);return l};import{R as me,_ as W,d as he,l as _e,v as O,c as v,r as A,u as G,a as X,b as fe,k as te,h as H,e as z,f as b,g as ve,i as ge,j as K,m as ne,n as ye,o as oe,p as ke,q as xe,s as Be,t as Ce,w as we,x as ae,y as Ne,z as De,A as be,T as $e,B as Ee,C as Se,D as Ae}from"./TripDetail.98eade70.js";const Re={__name:"App",setup(l){return(t,e)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(me),null,{default:Vue.withCtx(({Component:n})=>[(Vue.openBlock(),Vue.createBlock(Vue.KeepAlive,{exclude:["Charge","Drive"]},[(Vue.openBlock(),Vue.createBlock(Vue.resolveDynamicComponent(n)))],1024))]),_:1}))}};const Fe={class:"left"},Pe=Vue.createElementVNode("div",{class:"right top"},null,-1),je=Vue.createElementVNode("div",{class:"right middle"},null,-1),Te=Vue.createElementVNode("div",{class:"right bottom"},null,-1),qe={__name:"Battery",props:{percent:{type:Number,default:50},width:{type:Number,default:25},height:{type:Number,default:12}},setup(l){return(t,e)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:"battery",style:Vue.normalizeStyle({width:`${l.width}px`,height:`${l.height}px`})},[Vue.createElementVNode("div",Fe,[Vue.createElementVNode("div",{class:Vue.normalizeClass({percent:!0,warn:l.percent<=20}),style:Vue.normalizeStyle({width:`${l.percent}%`})},null,6)]),Pe,je,Te],4))}};var re={exports:{}};(function(l){(function(t){l.exports?(t.default=t,l.exports=t):t(typeof Highcharts!="undefined"?Highcharts:void 0)})(function(t){function e(n,r,u,o){n.hasOwnProperty(r)||(n[r]=o.apply(null,u),typeof CustomEvent=="function"&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:r,module:n[r]}})))}t=t?t._modules:{},e(t,"Series/XRange/XRangeSeriesDefaults.js",[t["Core/Utilities.js"]],function(n){var r=n.correctFloat,u=n.isNumber,o=n.isObject;return{colorByPoint:!0,dataLabels:{formatter:function(){var i=this.point.partialFill;if(o(i)&&(i=i.amount),u(i)&&0<i)return r(100*i)+"%"},inside:!0,verticalAlign:"middle"},tooltip:{headerFormat:'<span style="font-size: 10px">{point.x} - {point.x2}</span><br/>',pointFormat:'<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.yCategory}</b><br/>'},borderRadius:3,pointRange:0}}),e(t,"Series/XRange/XRangePoint.js",[t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(n,r){var u=this&&this.__extends||function(){var i=function(d,s){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,h){p.__proto__=h}||function(p,h){for(var g in h)h.hasOwnProperty(g)&&(p[g]=h[g])},i(d,s)};return function(d,s){function p(){this.constructor=d}i(d,s),d.prototype=s===null?Object.create(s):(p.prototype=s.prototype,new p)}}(),o=n.series.prototype.pointClass.prototype;return r=r.extend,n=function(i){function d(){var s=i!==null&&i.apply(this,arguments)||this;return s.options=void 0,s.series=void 0,s}return u(d,i),d.getColorByCategory=function(s,p){var h=s.options.colors||s.chart.options.colors;return s=p.y%(h?h.length:s.chart.options.chart.colorCount),{colorIndex:s,color:h&&h[s]}},d.prototype.resolveColor=function(){var s=this.series;if(s.options.colorByPoint&&!this.options.color){var p=d.getColorByCategory(s,this);s.chart.styledMode||(this.color=p.color),this.options.colorIndex||(this.colorIndex=p.colorIndex)}else this.color||(this.color=s.color)},d.prototype.init=function(){return o.init.apply(this,arguments),this.y||(this.y=0),this},d.prototype.setState=function(){o.setState.apply(this,arguments),this.series.drawPoint(this,this.series.getAnimationVerb())},d.prototype.getLabelConfig=function(){var s=o.getLabelConfig.call(this),p=this.series.yAxis.categories;return s.x2=this.x2,s.yCategory=this.yCategory=p&&p[this.y],s},d.prototype.isValid=function(){return typeof this.x=="number"&&typeof this.x2=="number"},d}(n.seriesTypes.column.prototype.pointClass),r(n.prototype,{ttBelow:!1,tooltipDateKeys:["x","x2"]}),n}),e(t,"Series/XRange/XRangeSeries.js",[t["Core/Globals.js"],t["Core/Color/Color.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"],t["Series/XRange/XRangeSeriesDefaults.js"],t["Series/XRange/XRangePoint.js"]],function(n,r,u,o,i,d){function s(){if(this.isXAxis){for(var D=q(this.dataMax,-Number.MAX_VALUE),y=0,a=this.series;y<a.length;y++){var c=a[y];if(c.x2Data){var V=0;for(c=c.x2Data;V<c.length;V++){var f=c[V];if(f&&f>D){D=f;var m=!0}}}}m&&(this.dataMax=D)}}var p=this&&this.__extends||function(){var D=function(y,a){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,V){c.__proto__=V}||function(c,V){for(var f in V)V.hasOwnProperty(f)&&(c[f]=V[f])},D(y,a)};return function(y,a){function c(){this.constructor=y}D(y,a),y.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}();n=n.noop;var h=r.parse,g=u.series.prototype,R=u.seriesTypes.column,F=o.addEvent,$=o.clamp,T=o.defined;r=o.extend;var M=o.find,L=o.isNumber,I=o.isObject,P=o.merge,q=o.pick,J=[];return o=function(D){function y(){var a=D!==null&&D.apply(this,arguments)||this;return a.data=void 0,a.options=void 0,a.points=void 0,a}return p(y,D),y.compose=function(a){J.indexOf(a)===-1&&(J.push(a),F(a,"afterGetSeriesExtremes",s))},y.prototype.init=function(){D.prototype.init.apply(this,arguments),this.options.stacking=void 0},y.prototype.getColumnMetrics=function(){var a=this,c=function(){for(var f=0,m=a.chart.series;f<m.length;f++){var x=m[f],k=x.xAxis;x.xAxis=x.yAxis,x.yAxis=k}};c();var V=D.prototype.getColumnMetrics.call(this);return c(),V},y.prototype.cropData=function(a,c,V,f){return c=g.cropData.call(this,this.x2Data,c,V,f),c.xData=a.slice(c.start,c.end),c},y.prototype.findPointIndex=function(a){var c=this.cropStart,V=this.points,f=a.id;if(f)var m=(m=M(V,function(x){return x.id===f}))?m.index:void 0;return typeof m=="undefined"&&(m=(m=M(V,function(x){return x.x===a.x&&x.x2===a.x2&&!x.touched}))?m.index:void 0),this.cropped&&L(m)&&L(c)&&m>=c&&(m-=c),m},y.prototype.alignDataLabel=function(a){var c=a.plotX;a.plotX=q(a.dlBox&&a.dlBox.centerX,a.plotX),D.prototype.alignDataLabel.apply(this,arguments),a.plotX=c},y.prototype.translatePoint=function(a){var c=this.xAxis,V=this.yAxis,f=this.columnMetrics,m=this.options,x=m.minPointLength||0,k=(a.shapeArgs&&a.shapeArgs.width||0)/2,w=this.pointXOffset=f.offset,E=q(a.x2,a.x+(a.len||0)),C=a.plotX,N=c.translate(E,0,0,0,1);E=Math.abs(N-C);var j=this.chart.inverted,B=q(m.borderWidth,1)%2/2,S=f.offset,U=Math.round(f.width);x&&(x-=E,0>x&&(x=0),C-=x/2,N+=x/2),C=Math.max(C,-10),N=$(N,-10,c.len+10),T(a.options.pointWidth)&&(S-=(Math.ceil(a.options.pointWidth)-U)/2,U=Math.ceil(a.options.pointWidth)),m.pointPlacement&&L(a.plotY)&&V.categories&&(a.plotY=V.translate(a.y,0,1,0,1,m.pointPlacement)),m=Math.floor(Math.min(C,N))+B,m={x:m,y:Math.floor(a.plotY+S)+B,width:Math.floor(Math.max(C,N))+B-m,height:U,r:this.options.borderRadius},a.shapeArgs=m,j?a.tooltipPos[1]+=w+k:a.tooltipPos[0]-=k+w-m.width/2,k=m.x,w=k+m.width,0>k||w>c.len?(k=$(k,0,c.len),w=$(w,0,c.len),N=w-k,a.dlBox=P(m,{x:k,width:w-k,centerX:N?N/2:null})):a.dlBox=null,k=a.tooltipPos,w=j?1:0,N=j?0:1,f=this.columnMetrics?this.columnMetrics.offset:-f.width/2,k[w]=j?k[w]+m.width/2:k[w]+(c.reversed?-1:0)*m.width,k[N]=$(k[N]+(j?-1:1)*f,0,V.len-1),(V=a.partialFill)&&(I(V)&&(V=V.amount),L(V)||(V=0),a.partShapeArgs=P(m,{r:this.options.borderRadius}),C=Math.max(Math.round(E*V+a.plotX-C),0),a.clipRectArgs={x:c.reversed?m.x+E-C:m.x,y:m.y,width:C,height:m.height})},y.prototype.translate=function(){D.prototype.translate.apply(this,arguments);for(var a=0,c=this.points;a<c.length;a++)this.translatePoint(c[a])},y.prototype.drawPoint=function(a,c){var V=this.options,f=this.chart.renderer,m=a.shapeType,x=a.shapeArgs,k=a.partShapeArgs,w=a.clipRectArgs,E=V.stacking&&!V.borderRadius,C=a.state,N=V.states[C||"normal"]||{},j=typeof C=="undefined"?"attr":c;C=this.pointAttribs(a,C),N=q(this.chart.options.chart.animation,N.animation);var B=a.graphic,S=a.partialFill;a.isNull||a.visible===!1?B&&(a.graphic=B.destroy()):(B?B.rect[c](x):(a.graphic=B=f.g("point").addClass(a.getClassName()).add(a.group||this.group),B.rect=f[m](P(x)).addClass(a.getClassName()).addClass("highcharts-partfill-original").add(B)),k&&(B.partRect?(B.partRect[c](P(k)),B.partialClipRect[c](P(w))):(B.partialClipRect=f.clipRect(w.x,w.y,w.width,w.height),B.partRect=f[m](k).addClass("highcharts-partfill-overlay").add(B).clip(B.partialClipRect))),this.chart.styledMode||(B.rect[c](C,N).shadow(V.shadow,null,E),k&&(I(S)||(S={}),I(V.partialFill)&&(S=P(V.partialFill,S)),a=S.fill||h(C.fill).brighten(-.3).get()||h(a.color||this.color).brighten(-.3).get(),C.fill=a,B.partRect[j](C,N).shadow(V.shadow,null,E))))},y.prototype.drawPoints=function(){for(var a=this.getAnimationVerb(),c=0,V=this.points;c<V.length;c++)this.drawPoint(V[c],a)},y.prototype.getAnimationVerb=function(){return this.chart.pointCount<(this.options.animationLimit||250)?"animate":"attr"},y.prototype.isPointInside=function(a){var c=a.shapeArgs,V=a.plotX,f=a.plotY;return c?typeof V!="undefined"&&typeof f!="undefined"&&0<=f&&f<=this.yAxis.len&&0<=(c.x||0)+(c.width||0)&&V<=this.xAxis.len:D.prototype.isPointInside.apply(this,arguments)},y.defaultOptions=P(R.defaultOptions,i),y}(R),r(o.prototype,{pointClass:d,cropShoulder:1,getExtremesFromAll:!0,parallelArrays:["x","x2","y"],requireSorting:!1,type:"xrange",animate:g.animate,autoIncrement:n,buildKDTree:n}),u.registerSeriesType("xrange",o),o}),e(t,"masters/modules/xrange.src.js",[t["Core/Globals.js"],t["Series/XRange/XRangeSeries.js"]],function(n,r){r.compose(n.Axis)})})})(re);var Me=re.exports;const Le={__name:"RangeSocChart",props:{height:{type:Number,default:150},isToday:{type:Boolean},data:{type:Array,default:()=>[]}},setup(l){const t=l,e=Vue.ref(t.isToday?{min:Date.now()-24*60*60*1e3,max:Date.now()}:{});return Vue.watch(()=>t.data,n=>{t.isToday&&(e.value={min:Date.now()-24*60*60*1e3,max:Date.now()})}),(n,r)=>(Vue.openBlock(),Vue.createBlock(W,{title:"\u7535\u91CF&\u7EED\u822A",height:150,data:l.data,yAxis:[{max:100,min:0},{min:0}],fields:[["battery_level"],["range"]],"series-options":[{stickyTracking:!1,tooltip:{valueDecimals:0,valueSuffix:"%"}}],"fields-name":{battery_level:"\u7535\u91CF",range:"\u91CC\u7A0B"},extremes:e.value},null,8,["data","extremes"]))}},Oe=Vue.createElementVNode("br",null,null,-1),Xe={__name:"StateHistory",props:{history:{type:Array,required:!0}},setup(l){const t=l;Highcharts.setOptions({time:{timezoneOffset:new Date().getTimezoneOffset()},credits:{enabled:!1}}),Me(Highcharts);const e=Vue.ref(null),n=[{state:"\u5728\u7EBF",color:"#86cede"},{state:"\u884C\u9A76",color:"#8445b2"},{state:"\u5145\u7535",color:"#edcc47"},{state:"\u79BB\u7EBF",color:"#f4b567"},{state:"\u4F11\u7720",color:"#6aa356"},{state:"\u5728\u7EBF",color:"#86cede"},{state:"\u5347\u7EA7",color:"red"}];function r(o){return{pointWidth:40,data:o.map(({time:i,state:d},s)=>ee({x:i,x2:(o[s+1]||{time:Date.now()}).time,y:0},n[d])),dataLabels:{enabled:!0}}}const u=Vue.ref(t.history[1]||[]);return Vue.watch(()=>t.history,([o,i])=>{u.value=i,e.value.chart.series[0].setData(r(o).data);const d=Date.now()-86400*1e3,s=Date.now();e.value.chart.xAxis[0].setExtremes(d,s)}),Vue.watch(e,async()=>{await new Promise(o=>setTimeout(o,100)),e.value.chart=Highcharts.chart(e.value,{chart:{type:"xrange"},title:{text:null},xAxis:{type:"datetime",min:Date.now()-86400*1e3,max:Date.now()},tooltip:{formatter:function(){return`${n.find(i=>i.color===this.color).state} ${he(this.x2-this.x)}`}},yAxis:{title:{text:""},categories:["State"],labels:{enabled:!1},gridLineWidth:0},legend:{enabled:!1},plotOptions:{series:{borderRadius:0,animation:!1},xrange:{borderWidth:1e-4}},series:[r(t.history[0])]})}),(o,i)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Oe,Vue.createElementVNode("div",{ref_key:"stateChart",ref:e,style:{height:"80px"}},null,512),Vue.createVNode(Le,{data:u.value,"is-today":""},null,8,["data"])],64))}};Vue.ref([]);async function ie(){const l=await _e();return l&&l.length>0&&(O.value=l,(!v.value.id||!l.find(t=>t.id===v.value.id))&&(v.value=l[0])),l}ie();var Y={async getHomeData(){return v.value.id&&await A("/home_data",{car_id:v.value.id})},async getProjectedRange(){return A("/projected_range",{car_id:v.value.id})},async getUpdates(){return A("/updates",{car_id:v.value.id})}};const He={class:"page"},Ie={style:{display:"flex"}},Ue={key:0},ze=Vue.createElementVNode("div",{style:{"flex-grow":"1"}},null,-1),We={key:0,style:{display:"flex","align-items":"center"}},Ge={key:0,style:{color:"red"}},Ke={key:1},Ye=Vue.createElementVNode("span",{style:{"font-size":"15px"}},"\u2744\uFE0F",-1),Je={key:2,style:{"margin-left":"10px"}},Qe={key:3,style:{"margin-left":"10px"}},Ze={key:1},et={key:0},tt={key:2},nt={key:3,class:"home-footer"},ot={key:0},at={key:1},rt={__name:"Home",setup(l){const t=G();X.value||t.push("/settings");const e=Vue.ref(null),n=Vue.ref([]);let r=0,u;const o=Vue.ref(!1);async function i(){if(!o.value){o.value=!0;try{const{state:d,stateHistory:s}=await Y.getHomeData();e.value=d,n.value=s,r=Date.now()}finally{o.value=!1}}}return Vue.watch(v,i),Vue.onActivated(()=>{document.title=`\u8F66\u8F86\u9996\u9875 - ${v.value.name||""}`,u&&clearInterval(u),Date.now()-r>30*1e3&&i(),u=setInterval(i,30*1e3)}),Vue.onDeactivated(()=>{u&&clearInterval(u),u=null}),(d,s)=>{const p=Vue.resolveComponent("nut-icon");return Vue.openBlock(),Vue.createElementBlock("div",He,[Vue.createElementVNode("div",Ie,[Vue.unref(v)?(Vue.openBlock(),Vue.createElementBlock("h4",Ue,[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(v).name)+" ",1),o.value?(Vue.openBlock(),Vue.createBlock(p,{key:0,size:"11",name:"loading"})):Vue.createCommentVNode("",!0)])):Vue.createCommentVNode("",!0),ze,Vue.createVNode(Vue.unref(fe),{to:"settings",style:{color:"#333"}},{default:Vue.withCtx(()=>[Vue.createVNode(p,{size:"18",name:"setting"})]),_:1})]),Vue.unref(v)?(Vue.openBlock(),Vue.createElementBlock("div",{key:0,class:"vehice-state",onClick:i},[e.value?(Vue.openBlock(),Vue.createElementBlock("div",We,[Vue.createVNode(qe,{style:{"margin-right":"8px"},percent:e.value.battery_level},null,8,["percent"]),Vue.createElementVNode("div",null,[e.value.battery_heater?(Vue.openBlock(),Vue.createElementBlock("span",Ge,"\u2307")):Vue.createCommentVNode("",!0),Vue.createElementVNode("span",null,Vue.toDisplayString(e.value.battery_level)+"%",1),e.value.battery_level-e.value.usable_battery_level>0?(Vue.openBlock(),Vue.createElementBlock("span",Ke,[Vue.createTextVNode("("),Ye,Vue.createTextVNode(Vue.toDisplayString(e.value.battery_level-e.value.usable_battery_level)+"%)",1)])):Vue.createCommentVNode("",!0),e.value.battery_level>0?(Vue.openBlock(),Vue.createElementBlock("span",Je,Vue.toDisplayString(e.value.ideal_battery_range_km.toFixed(0))+"/"+Vue.toDisplayString(Vue.unref(te)(e.value.ideal_battery_range_km*100/e.value.usable_battery_level)),1)):(Vue.openBlock(),Vue.createElementBlock("span",Qe,Vue.toDisplayString(e.value.ideal_battery_range_km.toFixed(0))+"km ",1))])])):Vue.createCommentVNode("",!0),e.value&&e.value.charge?(Vue.openBlock(),Vue.createElementBlock("div",Ze,[Vue.createTextVNode(" \u26A1 +"+Vue.toDisplayString(e.value.charge.charge_energy_added.toFixed(1))+"Kwh "+Vue.toDisplayString(e.value.charge.charger_power)+"Kw ",1),e.value.charge.charger_actual_current?(Vue.openBlock(),Vue.createElementBlock("span",et,Vue.toDisplayString(e.value.charge.charger_voltage)+"V "+Vue.toDisplayString(e.value.charge.charger_actual_current)+"/"+Vue.toDisplayString(e.value.charge.charger_pilot_current)+"A ",1)):Vue.createCommentVNode("",!0)])):Vue.createCommentVNode("",!0),e.value&&!e.value.update.end_date?(Vue.openBlock(),Vue.createElementBlock("div",tt," \u6B63\u5728\u66F4\u65B0"+Vue.toDisplayString(e.value.update.version),1)):Vue.createCommentVNode("",!0)])):Vue.createCommentVNode("",!0),n.value&&n.value.length>0?(Vue.openBlock(),Vue.createBlock(Xe,{key:1,history:n.value},null,8,["history"])):Vue.createCommentVNode("",!0),Vue.unref(v)?(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.CellGroup),{key:2},{default:Vue.withCtx(()=>[e.value?(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.Cell),{key:0,title:"\u6E29\u5EA6","sub-title":e.value.is_climate_on&&`\u7A7A\u8C03\u8BBE\u7F6E${e.value.driver_temp_setting}\u2103`||"",desc:`\u5916\u90E8:${e.value.outside_temp}\u2103 \u5185\u90E8:${e.value.inside_temp}\u2103`},null,8,["sub-title","desc"])):Vue.createCommentVNode("",!0),Vue.createVNode(Vue.unref(nutui.Cell),{title:"\u7EED\u822A",icon:"find",to:"/projected-range","is-link":""}),Vue.createVNode(Vue.unref(nutui.Cell),{title:"\u5145\u7535",icon:"order",to:"/charges","is-link":""}),Vue.createVNode(Vue.unref(nutui.Cell),{title:"\u884C\u7A0B",icon:"footprint",to:"/drives","is-link":""}),Vue.createVNode(Vue.unref(nutui.Cell),{title:"\u7EDF\u8BA1",icon:"horizontal",to:"/stats","is-link":""}),Vue.createVNode(Vue.unref(nutui.Cell),{title:"\u8F6F\u4EF6\u7248\u672C",icon:"top",to:"/updates","is-link":""}),Vue.createVNode(Vue.unref(nutui.Cell),{title:"Teslafi\u7248\u672C\u7EDF\u8BA1",icon:"more-x",to:"/teslafi","is-link":""})]),_:1})):Vue.createCommentVNode("",!0),Vue.unref(v)?(Vue.openBlock(),Vue.createElementBlock("div",nt,[Vue.createElementVNode("p",null,"Model "+Vue.toDisplayString(Vue.unref(v).model)+" "+Vue.toDisplayString(Vue.unref(v).trim_badging),1),Vue.createElementVNode("p",null,Vue.toDisplayString(Vue.unref(H)?Vue.unref(v).vin.replace(/.{6}$/,"******"):Vue.unref(v).vin),1),e.value?(Vue.openBlock(),Vue.createElementBlock("p",ot,Vue.toDisplayString(e.value.update.version),1)):Vue.createCommentVNode("",!0),e.value?(Vue.openBlock(),Vue.createElementBlock("p",at,Vue.toDisplayString(Vue.unref(te)(e.value.odometer)),1)):Vue.createCommentVNode("",!0)])):Vue.createCommentVNode("",!0)])}}},it={class:"page"},ut={style:{"text-align":"center"}},lt={__name:"Settings",setup(l){const t=G(),e=Vue.ref(!1),n=Vue.ref(!1),r=Vue.ref(X.value),u=Vue.ref(z.value),o=Vue.computed(()=>O.value.map(s=>({text:s.name,value:s.id}))),i=({selectedValue:s})=>{const p=O.value.find(h=>h.id==s);p&&(v.value=p)};async function d(){try{n.value=!0,X.value=r.value,z.value=u.value;const s=await ie();if(s&&s.length>0)ve(),t.replace("/");else throw new Error("No vehicles found")}catch(s){alert("\u914D\u7F6E\u9519\u8BEF"),console.error(s),X.value="",z.value=""}finally{n.value=!1}}return(s,p)=>{const h=Vue.resolveComponent("nut-picker");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u8BBE\u7F6E"}),Vue.createElementVNode("div",it,[Vue.unref(O).length>0?(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.CellGroup),{key:0,title:"\u8BBE\u7F6E"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(nutui.Cell),{title:"\u9690\u85CF\u5B8C\u6574\u8F66\u8F86\u8BC6\u522B\u7801"},{link:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(nutui.Switch),{modelValue:Vue.unref(H),"onUpdate:modelValue":p[0]||(p[0]=g=>Vue.isRef(H)?H.value=g:null)},null,8,["modelValue"])]),_:1}),Vue.createVNode(Vue.unref(nutui.Cell),{title:"\u5F53\u524D\u8F66\u8F86: "+Vue.unref(v).name,desc:"\u5207\u6362",onClick:p[1]||(p[1]=()=>{e.value=!0})},null,8,["title"]),Vue.createVNode(h,{visible:e.value,"onUpdate:visible":p[2]||(p[2]=g=>e.value=g),title:"\u9009\u62E9\u8F66\u8F86",columns:Vue.unref(o),onConfirm:i},null,8,["visible","columns"])]),_:1})):Vue.createCommentVNode("",!0),Vue.createVNode(Vue.unref(nutui.CellGroup),{title:"TeslaMate\u8BBE\u7F6E"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(nutui.Input),{label:"URL",modelValue:r.value,"onUpdate:modelValue":p[3]||(p[3]=g=>r.value=g)},null,8,["modelValue"]),Vue.createVNode(Vue.unref(nutui.Input),{label:"ApiKey",modelValue:u.value,"onUpdate:modelValue":p[4]||(p[4]=g=>u.value=g)},null,8,["modelValue"])]),_:1}),Vue.createElementVNode("div",ut,[Vue.createVNode(Vue.unref(nutui.Button),{loading:n.value,type:"primary",onClick:d},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u4FDD\u5B58")]),_:1},8,["loading"])])])],64)}}},st={class:"page"},ct={__name:"ProjectedRange",setup(l){const t=Vue.ref();return Vue.onActivated(()=>Y.getProjectedRange().then(e=>t.value=e)),(e,n)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u6EE1\u7535\u7EED\u822A"}),Vue.createElementVNode("div",st,[Vue.createVNode(W,{title:"\u91CC\u7A0B - \u7EED\u822A",height:350,data:t.value,"is-time-series":!1,xField:"mileage",fields:[["projected_range"]],"fields-name":{projected_range:"\u6EE1\u7535\u7EED\u822A"},"series-options":[{tooltip:{valueDecimals:1,valueSuffix:"km"}}]},null,8,["data"]),Vue.createVNode(W,{title:"\u65F6\u95F4 - \u7EED\u822A",height:350,data:t.value,fields:[["projected_range"],["mileage"]],"fields-name":{projected_range:"\u6EE1\u7535\u7EED\u822A",mileage:"\u91CC\u7A0B\u8868"},"series-options":[{tooltip:{valueDecimals:1,valueSuffix:"km"}},{tooltip:{valueDecimals:0,valueSuffix:"km"}}]},null,8,["data"])])],64))}};function ue(l){return l.reduce((t,e)=>{const n=_.last(t);return n&&n.address===e.address&&n.car_id===e.car_id&&n.mode===e.mode&&n.latitude===e.latitude&&n.longitude===e.longitude&&e.end_date_ts+10*60*1e3<n.start_date_ts?(n.duration_min+=e.duration_min,n.charge_energy_added+=e.charge_energy_added,n.start_date=e.start_date,n.start_date_ts=e.start_date_ts):t.push(e),t},[])}async function dt(l,t){const e=await A("/charges",{car_id:v.value.id,from:l,to:t});return ue(e)}async function pt(l,t,e,n){const r=await A("/charge_detail",{charge_id:l,car_id:t,from:e,to:n}),u=r[0][0]["Range [km]"],o=r[0][0].time;let i=r[0][0]["Power [kW]"];return r[0].forEach((d,s)=>{i=Math.max(i,d["Power [kW]"]),d.rangeAdded=d["Range [km]"]-u,v.value.efficiency&&(d.kwhAdded=d.rangeAdded*v.value.efficiency,d.time>o&&(d.avgPower=Math.min(i,d.kwhAdded/(d.time-o)*3600*1e3)))}),r}const Vt={class:"page"},mt={__name:"Charges",setup(l){const t=Vue.ref();return Vue.onActivated(()=>{dt().then(e=>t.value=e.reduceRight((n,r,u)=>{u>0?r.distance=e[u-1].distance:delete r.distance;const o=new Date(r.start_date_ts),i=o.getFullYear()+"/"+(o.getMonth()+1);return n.length>0&&n[0].month===i?n[0].charges.unshift(r):n.unshift({month:i,charges:[r]}),n},[]))}),(e,n)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u5145\u7535"}),Vue.createElementVNode("div",Vt,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(t.value,r=>(Vue.openBlock(),Vue.createBlock(ge,{title:r.month,charges:r.charges},null,8,["title","charges"]))),256))])],64))}},ht={class:"page"},_t={name:"Charge"},ft=Object.assign(_t,{setup(l){const t=K(),e=Vue.ref(),n=Vue.ref(t.query.lat&&t.query.lng&&[[t.query.lat*1,t.query.lng*1,t.query.mode]]),r=Vue.ref();pt(t.query.id,t.query.car_id,t.query.from,t.query.to).then(async([o,[{start_date:i=Date.now()}={}]])=>{e.value=o,r.value=await ne(t.query.to,i)});async function u(){const{hash:o,id:i}=await ke(t.query.id,t.query.from,t.query.to);nutui.Dialog({content:`\u5206\u4EAB\u6210\u529F\uFF0C<a target="_blank" href="/trip.html#/charge?id=${i}&hash=${o}">\u70B9\u6B64\u67E5\u770B</a>`,noCancelBtn:!0})}return(o,i)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u5145\u7535\u8BE6\u60C5",share:u}),Vue.createElementVNode("div",ht,[Vue.createVNode(ye,{detail:e.value,position:n.value},null,8,["detail","position"]),Vue.createVNode(oe,{title:"\u672C\u6B21\u5145\u7535\u540E",drives:r.value},null,8,["drives"])])],64))}}),vt={class:"page"},gt={__name:"Drives",setup(l){let t=[];const e=Vue.ref([]);return Vue.onActivated(()=>{t[0]&&t[0].car_id!==v.value.id&&(t=[]);const n=t[0]&&t[0].start_date_ts+1e3||new Date().setHours(0,0,0,0)-30*86400*1e3,r=Date.now();ne(n,r).then(u=>{u.length!==0&&(t=[...u,...t],e.value=xe(t).groups)})}),(n,r)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u884C\u7A0B"}),Vue.createElementVNode("div",vt,[e.value.length===0?(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.Cell),{key:0,title:"\u6240\u9009\u65F6\u95F4\u8303\u56F4\u5185\u65E0\u884C\u9A76\u8BB0\u5F55"})):Vue.createCommentVNode("",!0),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.value,u=>(Vue.openBlock(),Vue.createBlock(oe,{title:u.date,drives:u.drives},null,8,["title","drives"]))),256))])],64))}};async function le(l,t){const e=await A("/positions",{car_id:v.value.id,from:l,to:t}),n=e.find(r=>r.range&&r.odometer);return e.forEach((r,u)=>{r.odometer-n.odometer>1&&r.range&&(r.avgSpeed=(r.odometer-n.odometer)/(r.time-n.time)*3600*1e3,v.value.efficiency&&(r.consumption=(n.range-r.range)/(r.odometer-n.odometer)*v.value.efficiency*1e3))}),e}const yt={class:"page"},kt={name:"Drive"},xt=Object.assign(kt,{setup(l){const t=K(),e=Vue.ref(),n=Vue.ref(),r=Vue.ref();Be(t.query.drive_id).then(async o=>{const{start_date_ts:i,end_date_ts:d}=e.value=o[0];n.value=await le(i,d),r.value=n.value.map(({latitude:s,longitude:p})=>[s,p])});async function u(){const{hash:o,id:i}=await we(t.query.drive_id);nutui.Dialog({content:`\u5206\u4EAB\u6210\u529F\uFF0C<a target="_blank" href="/trip.html#/drive?id=${i}&hash=${o}">\u70B9\u6B64\u67E5\u770B</a>`,noCancelBtn:!0})}return(o,i)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u884C\u7A0B\u8BE6\u60C5",share:u}),Vue.createElementVNode("div",yt,[Vue.createVNode(Ce,{drive:e.value,positions:n.value,track:r.value},null,8,["drive","positions","track"])])],64))}});function se(l,t,e){return A("/stats",{car_id:v.value.id,period:l,from:t,to:e})}async function Bt(l,t){const{charges:e,drives:n}=await A("/stats_detail",{car_id:v.value.id,from:l,to:t});return{charges:ue(e),drives:n}}const Ct={__name:"DayStats",props:{title:{type:String,default:""},from:{type:Number,default:0},to:{type:Number,default:0},r:{type:Number,default:0}},setup(l){const t=l,e=Vue.ref(!1),n=Vue.ref([]);return Vue.watch(()=>[t.from,t.to,t.r],async([r,u])=>{r>0&&u>0?(n.value=[],e.value=!0,n.value=await se("day",r,u)):e.value=!1}),(r,u)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.Popup),{position:"left",style:{"background-color":"#f7f8fa",width:"85%",height:"100%"},"z-index":1e4,visible:e.value,"onUpdate:visible":u[0]||(u[0]=o=>e.value=o)},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(nutui.CellGroup),{title:`${l.title} \u884C\u9A76\u4E86${n.value.reduce((o,i)=>o+i.sum_distance_km,0)}km`},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(n.value,o=>(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.Cell),{center:"",title:o.display,desc:`${(o.sum_duration_h/60).toFixed(0)}\u5206\u949F | ${o.sum_distance_km}km`,"sub-title":`\u6C14\u6E29${o.avg_outside_temp_c.toFixed(1)}\u2103 \u80FD\u8017${(145/o.efficiency).toFixed(0)}Wh/km`,to:{name:"Trip",query:{display:o.display,from:o.date_from,to:o.date_to},params:o},"is-link":""},null,8,["title","desc","sub-title","to"]))),256))]),_:1},8,["title"])]),_:1},8,["visible"]))}},wt={class:"page"},Nt=["onClick"],Dt={__name:"Stats",setup(l){const t=G();function e(o){t.push({name:"Trip",query:{display:o.display,from:o.date_from,to:o.date_to},params:o})}const n=Vue.ref({});function r({display:o,date_from:i,date_to:d}){n.value={title:o,from:i,to:d,r:Date.now()}}const u=Vue.ref();return Vue.onActivated(()=>{se().then(o=>u.value=o.reduce((i,d)=>{const s=d.display.split(" ")[0];return i.length>0&&i[i.length-1].year===s?i[i.length-1].stats.push(d):i.push({year:s,stats:[d]}),i},[]))}),ae(o=>{o.name==="Home"&&(n.value={})}),(o,i)=>{const d=Vue.resolveComponent("router-link"),s=Vue.resolveComponent("nut-icon");return Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u7EDF\u8BA1"}),Vue.createElementVNode("div",wt,[Vue.createVNode(Ct,{title:n.value.title,from:n.value.from,to:n.value.to,r:n.value.r},null,8,["title","from","to","r"]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(u.value,p=>(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.CellGroup),{title:`${p.year} \u884C\u9A76\u4E86${p.stats.reduce((h,g)=>h+g.sum_distance_km,0)}km`},{title:Vue.withCtx(()=>[Vue.createVNode(d,{class:"nut-cell-group__title",style:{"text-decoration":"none"},to:{name:"Trip",query:{display:p.year,from:Date.parse(p.year+"/1/1"),to:Date.parse(p.year*1+1+"/1/1")}}},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(`${p.year} \u884C\u9A76\u4E86${p.stats.reduce((h,g)=>h+g.sum_distance_km,0)}km`)+" > ",1)]),_:2},1032,["to"])]),default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(p.stats,h=>(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.Cell),{center:"",title:h.display,desc:`${(h.sum_duration_h/60).toFixed(0)}\u5206\u949F | ${h.sum_distance_km}km`,"sub-title":`\u6C14\u6E29${h.avg_outside_temp_c.toFixed(1)}\u2103 \u80FD\u8017${(145/h.efficiency).toFixed(0)}Wh/km`,onClick:g=>e(h),"is-link":""},{icon:Vue.withCtx(()=>[Vue.createElementVNode("div",{onClick:Vue.withModifiers(g=>r(h),["stop"])},[Vue.createVNode(s,{name:"left"}),Vue.createTextVNode("\xA0 ")],8,Nt)]),_:2},1032,["title","desc","sub-title","onClick"]))),256))]),_:2},1032,["title"]))),256))])],64)}}},bt={class:"page"},$t={__name:"Updates",setup(l){const t=Vue.ref();return Vue.onActivated(()=>{Y.getUpdates().then(e=>t.value=e)}),(e,n)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"\u8F6F\u4EF6\u7248\u672C"}),Vue.createElementVNode("div",bt,[Vue.createVNode(Vue.unref(nutui.CellGroup),{title:"\u7EDF\u8BA1\u7ED3\u679C"},{default:Vue.withCtx(()=>[!t.value||t.value.length===0?(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.Cell),{key:0,title:"\u5C1A\u65E0\u8F6F\u4EF6\u5347\u7EA7\u6570\u636E"})):Vue.createCommentVNode("",!0),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(t.value,(r,u)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(nutui.Cell),{title:r.version,desc:`\u5E73\u5747\u7EED\u822A${(r.avg_ideal_range_km||0).toFixed(0)}km`,"sub-title":`${new Date(r.time).toLocaleDateString()} \u4F7F\u7528${Vue.unref(Ne)(u>0?t.value[u-1].since_last_update*1e3:Date.now()-r.time)} \u5145\u7535${r.chg_ct}\u6B21`},null,8,["title","desc","sub-title"]))),256))]),_:1})])],64))}};const Et={class:"page",style:{overflow:"scroll"}},St={key:0},At={key:0},Rt=["href"],Ft={key:0},Pt={__name:"Teslafi",setup(l){const t=Vue.ref();Vue.onActivated(()=>{be().then(n=>t.value=n)});function e(n){return n.trim().split(/\s+/)}return(n,r)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:"Teslafi Firmware\u7EDF\u8BA1"}),Vue.createElementVNode("div",Et,[t.value?(Vue.openBlock(),Vue.createElementBlock("table",St,[Vue.createElementVNode("thead",null,[Vue.createElementVNode("tr",null,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(t.value.latestUpdates.head,u=>(Vue.openBlock(),Vue.createElementBlock("th",null,Vue.toDisplayString(u||"\u21E9"),1))),256))])]),Vue.createElementVNode("tbody",null,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(t.value.latestUpdates.versions,u=>(Vue.openBlock(),Vue.createElementBlock("tr",null,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(u,(o,i)=>(Vue.openBlock(),Vue.createElementBlock("td",null,[i!==1?(Vue.openBlock(),Vue.createElementBlock("div",At,Vue.toDisplayString(o),1)):(Vue.openBlock(),Vue.createElementBlock("a",{key:1,target:"_blank",href:`https://www.notateslaapp.com/software-updates/version/${e(o)[0]}/release-notes`},[Vue.createElementVNode("div",null,Vue.toDisplayString(e(o)[0]),1),e(o)[1]?(Vue.openBlock(),Vue.createElementBlock("div",Ft,"FSD"+Vue.toDisplayString(e(o)[1]),1)):Vue.createCommentVNode("",!0)],8,Rt))]))),256))]))),256))])])):Vue.createCommentVNode("",!0)])],64))}};var jt=De(Pt,[["__scopeId","data-v-6e939964"]]);const Tt={class:"page"},qt={name:"Trip"},Mt=Object.assign(qt,{setup(l){const t=K();let e=0,n;const r=Vue.ref({}),u=Vue.ref([]),o=Vue.ref([]),i=Vue.ref([]),d=Vue.ref(0);Vue.onActivated(()=>{const h=Date.now(),{from:g,to:R}=t.query;d.value=R-g,g&&R&&!n?(Bt(g,R).then(F=>{h>e&&(r.value=F,i.value=F.charges.map(({latitude:$,longitude:T,mode:M})=>[$,T,M]))}),le(g,R).then(F=>{h>e&&(u.value=F,o.value=F.map(({latitude:$,longitude:T})=>[$,T]))})):i.value=[...i.value]});const s=["Stats","Drives"];ae(function(h){e=Date.now(),s.indexOf(h.name)>=0?(u.value=[],r.value={},o.value=[],i.value=[],n=!1):n=!0});async function p(){const{hash:h,id:g}=await Ee(t.query.from,t.query.to);nutui.Dialog({content:`\u5206\u4EAB\u6210\u529F\uFF0C<a target="_blank" href="/trip.html#/?id=${g}&hash=${h}&display=${t.query.display}">\u70B9\u6B64\u67E5\u770B</a>`,noCancelBtn:!0})}return(h,g)=>(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,[Vue.createVNode(b,{title:`${Vue.unref(t).query.display}\u884C\u7A0B`,share:d.value<86400*1e3*7?p:null},null,8,["title","share"]),Vue.createElementVNode("div",Tt,[Vue.createVNode($e,{group:!0,drives:r.value.drives,charges:r.value.charges,positions:u.value,track:o.value,chargeMarkers:i.value},null,8,["drives","charges","positions","track","chargeMarkers"])])],64))}}),Lt=[{path:"/",name:"Home",component:rt},{path:"/settings",name:"Settings",component:lt},{path:"/projected-range",name:"ProjectedRange",component:ct},{path:"/charges",name:"Charges",component:mt},{path:"/charge",name:"Charge",component:ft},{path:"/stats",name:"Stats",component:Dt},{path:"/drives",name:"Drives",component:gt},{path:"/drive",name:"Drive",component:xt},{path:"/updates",name:"Updates",component:$t},{path:"/teslafi",name:"Teslafi",component:jt},{path:"/trip",name:"Trip",component:Mt}],ce=Se({history:Ae(),routes:Lt});ce.beforeEach((l,t,e)=>{window._hmt&&l.path&&window._hmt.push(["_trackPageview",l.fullPath]),e()});Vue.createApp(Re).use(nutui.Icon).use(nutui.Dialog).use(nutui.Picker).use(nutui.Popup).use(nutui.OverLay).use(ce).mount("#app");
